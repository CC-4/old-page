



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="CC4 Compiladores - Universidad Galileo">
      
      
        <link rel="canonical" href="https://cc-4.github.io/laboratorios/lab-10-codegen-ii/">
      
      
        <meta name="author" content="CC-4">
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="es">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.2.0">
    
    
      
        <title>Lab 10 (CodeGen II) - Compiladores</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.572ca0f0.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.8c900955.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../../stylesheets/emoji.css">
    
      <link rel="stylesheet" href="../../stylesheets/kbd.css">
    
      <link rel="stylesheet" href="../../convnet_demo/style.css">
    
      <link rel="stylesheet" href="../../stylesheets/button.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#lab-10-40codegen-ii41" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://cc-4.github.io/" title="Compiladores" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Compiladores
              </span>
              <span class="md-header-nav__topic">
                Lab 10 (CodeGen II)
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/CC-4/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      cc-4
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://cc-4.github.io/" title="Compiladores" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Compiladores
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/CC-4/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      cc-4
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Inicio" class="md-nav__link">
      Inicio
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Laboratorios
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Laboratorios
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../untitled/" title="Lab 1 (COOL)" class="md-nav__link">
      Lab 1 (COOL)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-2/" title="Lab 2 (Lexer)" class="md-nav__link">
      Lab 2 (Lexer)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-3/" title="Lab 3 (RDP)" class="md-nav__link">
      Lab 3 (RDP)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-4/" title="Lab 4 (JCUP)" class="md-nav__link">
      Lab 4 (JCUP)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-5/" title="Lab 5 (Symbol Table)" class="md-nav__link">
      Lab 5 (Symbol Table)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-6-analisis-semantico-i/" title="Lab 6 (Análisis Semántico I)" class="md-nav__link">
      Lab 6 (Análisis Semántico I)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-7-analisis-semantico-ii/" title="Lab 7 (Análisis Semántico II)" class="md-nav__link">
      Lab 7 (Análisis Semántico II)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-8-risc-v/" title="Lab 8 (RISC-V)" class="md-nav__link">
      Lab 8 (RISC-V)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-9-codegen/" title="Lab 9 (CodeGen I)" class="md-nav__link">
      Lab 9 (CodeGen I)
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Lab 10 (CodeGen II)
      </label>
    
    <a href="./" title="Lab 10 (CodeGen II)" class="md-nav__link md-nav__link--active">
      Lab 10 (CodeGen II)
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recordatorio" title="Recordatorio" class="md-nav__link">
    Recordatorio
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables-locales" title="Variables Locales" class="md-nav__link">
    Variables Locales
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#soporte" title="Soporte" class="md-nav__link">
    Soporte
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generando-codigo" title="Generando Código" class="md-nav__link">
    Generando Código
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assign" title="Assign" class="md-nav__link">
    Assign
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declaration" title="Declaration" class="md-nav__link">
    Declaration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparaciones" title="Comparaciones" class="md-nav__link">
    Comparaciones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#not" title="Not" class="md-nav__link">
    Not
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id" title="Id" class="md-nav__link">
    Id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#while" title="While" class="md-nav__link">
    While
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if" title="If" class="md-nav__link">
    If
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pruebas" title="Pruebas" class="md-nav__link">
    Pruebas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autograder" title="Autograder" class="md-nav__link">
    Autograder
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../lab-11-optimizaciones/" title="Lab 11 (Optimizaciones)" class="md-nav__link">
      Lab 11 (Optimizaciones)
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Proyectos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Proyectos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../proyectos/instalacion-material/" title="Instalación Material" class="md-nav__link">
      Instalación Material
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../proyectos/analisis-lexico/" title="Análisis Léxico" class="md-nav__link">
      Análisis Léxico
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../proyectos/analisis-sintactico/" title="Análisis Sintáctico" class="md-nav__link">
      Análisis Sintáctico
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../proyectos/analisis-semantico/" title="Análisis Semántico" class="md-nav__link">
      Análisis Semántico
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../proyectos/generacion-de-codigo/" title="Generación de Código" class="md-nav__link">
      Generación de Código
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#recordatorio" title="Recordatorio" class="md-nav__link">
    Recordatorio
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#variables-locales" title="Variables Locales" class="md-nav__link">
    Variables Locales
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#soporte" title="Soporte" class="md-nav__link">
    Soporte
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generando-codigo" title="Generando Código" class="md-nav__link">
    Generando Código
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#assign" title="Assign" class="md-nav__link">
    Assign
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#declaration" title="Declaration" class="md-nav__link">
    Declaration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comparaciones" title="Comparaciones" class="md-nav__link">
    Comparaciones
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#not" title="Not" class="md-nav__link">
    Not
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#id" title="Id" class="md-nav__link">
    Id
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#while" title="While" class="md-nav__link">
    While
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#if" title="If" class="md-nav__link">
    If
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pruebas" title="Pruebas" class="md-nav__link">
    Pruebas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autograder" title="Autograder" class="md-nav__link">
    Autograder
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/CC-4/edit/master/page/es/docs/laboratorios/lab-10-codegen-ii.md" title="Editar esta página" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="lab-10-40codegen-ii41">Lab 10 (CodeGen II)<a class="headerlink" href="#lab-10-40codegen-ii41" title="Permanent link">&para;</a></h1>
<p>Para este laboratorio van a completar la generación de código para el lenguaje Viper</p>
<p>Los archivos necesarios para este laboratorio los pueden encontrar en el siguiente enlace:</p>
<div class="codehilite"><pre><span></span>https://classroom.github.com/a/Oe7pFZk2
</pre></div>

<h2 id="recordatorio">Recordatorio<a class="headerlink" href="#recordatorio" title="Permanent link">&para;</a></h2>
<p>Por favor revisen el siguiente enlace para recordarse cómo está estructurado el <em><strong>Activation Record</strong></em> en Viper:</p>
<p><a href="https://cc-4.github.io/labs/lab09/#activation-record">Lab 9: Activation Record</a></p>
<h2 id="variables-locales">Variables Locales<a class="headerlink" href="#variables-locales" title="Permanent link">&para;</a></h2>
<p>Si no se recuerden de la firma del método <code>code</code> aquí está nuevamente:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kt">void</span> <span class="nf">code</span><span class="o">(</span><span class="n">Counter</span> <span class="n">locals</span><span class="o">,</span> <span class="n">SymbolTable</span> <span class="n">O</span><span class="o">,</span> <span class="n">PrintStream</span> <span class="n">p</span><span class="o">)</span>
</pre></div>

<p>Los parámetros tienen el siguiente significado:</p>
<ul>
<li><strong>locals</strong>: un contador que nos ayuda a saber cual es el siguiente espacio disponible en el área de variables locales dentro del activation record en relación al frame pointer.</li>
<li><strong>O</strong>: Es nuestra tabla de símbolos, esta nos sirve para guardar en que posición del activation record se encuentran los símbolos (variables locales y parámetros) en relación al <em>frame pointer.</em></li>
<li><strong>p</strong>: Nos sirve para imprimir el código generado a un archivo.Activation Record</li>
</ul>
<p>Cuando ustedes implementaron el nodo <strong>Function</strong> se dieron cuenta que fue necesario llamar al método <code>locals()</code> para preparar parte del prólogo de la función (reservar espacio). Esta función solo tiene una tarea en específico y es decir la cantidad de espacio necesario a reservar dentro del activation record para todas las variables locales (sin contar parámetros formales). Esta función lo que hace es visitar cada nodo dentro de los statements de una función (recursivamente) y verificar si son una instancia del nodo <strong>Declaration</strong> e ir incrementando la cantidad de espacio con <code>+1</code> cada vez que esto suceda. Si ustedes revisan la implementación de este método realmente hace más cosas, por ejemplo en el caso de un <strong>If</strong>:</p>
<div class="codehilite"><pre><span></span><span class="k">if</span> <span class="p">(</span><span class="n">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="nb">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">z</span> <span class="o">=</span> <span class="mi">30</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<p><code>locals()</code> devolvería 2 en vez de 1, porque en tiempo de compilación no se sabe si se va a tomar la consecuencia o la alternativa (a menos que se hiciera una optimización que por el momento está fuera del objetivo de este laboratorio), por lo que es necesario devolver el <strong>máximo</strong> entre los dos bloques de statements del <strong>If</strong>. Una implementación un poco más <em>ineficiente</em> en términos de memoria sería que <code>locals()</code> devolviera 3 para <code>x</code> , <code>y</code> y <code>z</code>, esto es ineficiente porque el espacio que se reserva para <code>x</code> y <code>y</code> se puede reutilizar para <code>z</code> porque el <em><strong>scope</strong></em> de la consecuencia no es el mismo ni se comparte con el de la alternativa. Ustedes son libres de implementar esto en su proyecto como ustedes crean que les permita terminarlo al 100%. </p>
<p>Otra cosa importante que tienen que tener claro, es que el único nodo que puede aumentar la cantidad de espacio a reservar en Viper es <strong>Declaration</strong> y los lugares donde puede aparecer este nodo es dentro de una función, dentro de los bloques de un <strong>If</strong>, y dentro del bloque de un <strong>While</strong>. En COOL ustedes van a tener que considerar a <strong>Let</strong> y a <strong>Typecase</strong> como los responsables de incrementar la cantidad de espacio. </p>
<p>Bien, ahora que ya está un poco más claro como funciona <code>locals()</code> es hora de hablar un poco de como utilizar ese espacio (<strong>lo que necesitan realmente para este laboratorio</strong>). Como el espacio se reserva en el activation record de la función, para referenciar una posición de ese espacio de manera fácil es utilizando el frame pointer (el registro<code>fp</code>).  Volvamos al ejemplo del laboratorio pasado:</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span> <span class="n">void</span> <span class="p">{</span>
    <span class="nb">int</span> <span class="n">var</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="k">print</span><span class="p">(</span><span class="n">var</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>

<p><img alt="Activation Record de la Funci&#xF3;n foo" src="../.gitbook/assets/screenshot-from-2019-10-07-22-17-35.png" /></p>
<p>Si se quisiera acceder al valor de la variable <code>var</code> bastaría con hacer lo siguiente en el ensamblador:</p>
<div class="codehilite"><pre><span></span>lw a0, 8(fp)
</pre></div>

<div class="admonition note"> <p class=admonition-title>Para su proyecto</p>
<p>Como COOL es orientado a objetos y pueden haber atributos en cada clase, cuando se hace referencia a un identificador, este podría ser un atributo o variable local por lo que para hacer referencia a su espacio de memoria podría ser utilizando el frame pointer o el registro <code>s0</code> que guarda el <em>self object</em>.</p></div>
<h2 id="soporte">Soporte<a class="headerlink" href="#soporte" title="Permanent link">&para;</a></h2>
<p>Se les provee como en el laboratorio pasado un compilador completo de Viper:</p>
<div class="codehilite"><pre><span></span>./vipercl &lt;archivo .vp&gt;
</pre></div>

<p>pueden probar esto para tener una referencia de como es que se tiene que generar código para los diferentes nodos de este laboratorio (pueden hacer lo mismo en el proyecto con <code>coolc-rv</code>).</p>
<p>Para correr un archivo compilado, pueden utilizar:</p>
<div class="codehilite"><pre><span></span>./run &lt;archivo .s&gt;
</pre></div>

<p>Adicionalmente pueden utilizar los métodos y variables estáticas de la clase  <strong>CgenSupport</strong> para ayudarse a generar código.</p>
<h2 id="generando-codigo">Generando Código<a class="headerlink" href="#generando-codigo" title="Permanent link">&para;</a></h2>
<p>Los nodos restantes que ustedes tienen que completar son los siguientes:</p>
<ul>
<li><strong>Assign</strong></li>
<li><strong>Declaration</strong></li>
<li><strong>Equal</strong></li>
<li><strong>LessEqual</strong></li>
<li><strong>LessThan</strong></li>
<li><strong>Not</strong></li>
<li><strong>Id</strong></li>
<li><strong>If</strong></li>
<li><strong>While</strong></li>
</ul>
<p>Para que tengan una idea de que tanto tienen que realizar, aquí van unas estadísticas:</p>
<div class="codehilite"><pre><span></span> src/main/java/viper/tree/Assign.java      <span class="p">|</span>  <span class="m">4</span> +++-
 src/main/java/viper/tree/Declaration.java <span class="p">|</span>  <span class="m">6</span> +++++-
 src/main/java/viper/tree/Equal.java       <span class="p">|</span> <span class="m">11</span> ++++++++++-
 src/main/java/viper/tree/Id.java          <span class="p">|</span>  <span class="m">3</span> ++-
 src/main/java/viper/tree/If.java          <span class="p">|</span> <span class="m">15</span> ++++++++++++++-
 src/main/java/viper/tree/LessEqual.java   <span class="p">|</span> <span class="m">11</span> ++++++++++-
 src/main/java/viper/tree/LessThan.java    <span class="p">|</span> <span class="m">11</span> ++++++++++-
 src/main/java/viper/tree/Not.java         <span class="p">|</span>  <span class="m">8</span> +++++++-
 src/main/java/viper/tree/While.java       <span class="p">|</span> <span class="m">12</span> +++++++++++-
 <span class="m">9</span> files changed, <span class="m">72</span> insertions<span class="o">(</span>+<span class="o">)</span>, <span class="m">9</span> deletions<span class="o">(</span>-<span class="o">)</span>
</pre></div>

<h3 id="assign">Assign<a class="headerlink" href="#assign" title="Permanent link">&para;</a></h3>
<p>La generación de código para <strong>assign</strong> es de pocos pasos. Primero se tiene que mandar recursivamente a <code>code</code> de la expresión del nodo y cuando regrese el resultado estará en <code>a0</code>, luego determinar a que distancia del frame pointer esta guardada esa variable utilizando a <code>O</code> y por último guardar el resultado en ese espacio.</p>
<div class="admonition note"> <p class=admonition-title>Reutilizando la tabla O</p><p>Utilicen <code>O.lookup(name)</code>para determinar esa distancia. ¿Por qué lookup y no probe?...</p></div>
<h3 id="declaration">Declaration<a class="headerlink" href="#declaration" title="Permanent link">&para;</a></h3>
<p>En <strong>Declaration</strong> casi se tiene que hacer lo mismo que en <strong>Assign</strong>, la diferencia es que en <strong>Declaration</strong> se está creando una variable y se le está asignando un valor inicial y en <strong>Assign</strong> la variable ya fue creada y solo se le está asignado un nuevo valor. Tienen que llamar a <code>code</code> de <code>init</code> recursivamente, el resultado cuando regrese estará en <code>a0</code>. Tienen que reservar el siguiente espacio disponible en el área de variables locales para la variable que está siendo creada y agregar esta información en la tabla <code>O</code>. Luego  guardar <code>a0</code> en ese espacio. Por último como este nodo no es una expresión, tenemos que cargar en <code>a0</code> el valor de void que es simplemente un 0.</p>
<div class="admonition note"> <p class=admonition-title>Usando el contador locals</p><p>Utilicen <code>locals.inc()</code> para reservar el siguiente espacio y <code>O.add(name, offset)</code> para guardar esa información en la tabla de símbolos.</p></div>
<div class="admonition note"> <p class=admonition-title>Cargando en a0</p><p>Para cargar en <code>a0</code> void pueden hacer lo siguiente:</p>
<p><div class="codehilite"><pre><span></span><span class="n">CgenSupport</span><span class="o">.</span><span class="na">emitLoadImm</span><span class="o">(</span><span class="n">CgenSupport</span><span class="o">.</span><span class="na">A0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">p</span><span class="o">);</span>
</pre></div></p></div>
<h3 id="comparaciones">Comparaciones<a class="headerlink" href="#comparaciones" title="Permanent link">&para;</a></h3>
<p>Para <strong>LessEqual</strong>, <strong>LessThan</strong> e <strong>Equal</strong>, la generación de código es igual en Viper. Primero tienen que crear una nueva etiqueta, llamar recursivamente a <code>code</code> del primer operando, hacer push de <code>a0</code> en el stack, luego llamar recursivamente a <code>code</code> del segundo operando, mover el resultado al registro <code>t1</code> hacer pop del stack hacia el registro <code>t2</code> , cargar en <code>a0</code> el boolean <code>true</code> efectuar la comparación correspondiente (&lt;, &lt;=, ==) utilizando los registros <code>t1</code> y <code>t2</code> , cargar el boolean <code>false</code> en caso de que la comparación no se cumpla y por último definir la etiqueta que crearon.</p>
<div class="admonition note"> <p class=admonition-title>Etiquetas</p><p>Para crear una nueva etiqueta pueden utilizar el método <code>nextLabel()</code> de <strong>CgenSupport</strong>. Para definir la etiqueta pueden utilizar <code>emitLabelDef(label, p)</code> también de <strong>CgenSupport</strong>.</p></div>
<h3 id="not">Not<a class="headerlink" href="#not" title="Permanent link">&para;</a></h3>
<p>El <strong>Not</strong> es similar a las comparaciones, lo único es que aquí solo mandamos a llamar a <code>code</code> del único operando que hay. Luego se tienen que realizar los mismos pasos que se mencionaron anterior mente.</p>
<div class="admonition note"> <p class=admonition-title>Branch on equal zero</p><p>Van a encontrar útil el método <code>CgenSupport.emitBeqz</code></p></div>
<h3 id="id">Id<a class="headerlink" href="#id" title="Permanent link">&para;</a></h3>
<p>Como sabemos la distancia desde el frame pointer en la que el <strong>Id</strong> fue guardado podemos utilizar la tabla <code>O</code> para obtener esa distancia y cargar en el registro <code>a0</code> el valor de ese espacio en memoria.</p>
<h3 id="while">While<a class="headerlink" href="#while" title="Permanent link">&para;</a></h3>
<p>Primero se tienen que crear dos etiquetas, una para iterar y otra para salir del ciclo, definir una de las primeras etiquetas (la de iterar), hacer <code>code</code> de la condición, comparar <code>a0</code> con 0 para saltar a la etiqueta para salir (recurden 0 es falso y 1 verdadero), crear un nuevo scope para el cuerpo del ciclo, hacer <code>code</code> del body (para esto tienen que crear una copia del contador de variables locales), salir del scope que se acaba de crear, saltar a la etiqueta que nos sirve para iterar, definir la etiqueta para salir, por último cargar <code>void</code>al registro <code>a0</code>.</p>
<div class="admonition note"> <p class=admonition-title>Copiando el contador locals</p><p>Utilicen el método <code>locals.copy()</code> para crear una copia del contador de variables locales.</p></div>
<h3 id="if">If<a class="headerlink" href="#if" title="Permanent link">&para;</a></h3>
<p>El <strong>If</strong> es similar al <strong>While</strong>, primero se crean dos etiquetas, una para la alternativa y otra para la salir de la consecuencia, luego se manda a llamar a <code>code</code> del predicado del nodo, luego se tiene que comparar <code>a0</code> con 0 para saltar a la alternativa, luego se crear un scope y se manda a llamar a <code>code</code> de <code>then</code> (se tiene que crear una copia de locals como se hizo en el <strong>While</strong>), salir del scope que se acaba de crear, saltar a la etiqueta de salir de la consecuencia, definir la etiqueta de la alternativa, crear un nuevo scope (aquí también se tiene que copiar locals), salir del scope que se acaba de crear, definir la etiqueta de salir y por último cargar en <code>a0</code> el valor <code>void</code> .</p>
<p>Listo han terminado de generar código para un lenguaje de bastante modesto, pero que puede hacer cosas interesantes todavía, por ejemplo:</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span> <span class="nb">int</span> <span class="p">{</span>
  <span class="nb">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span> <span class="nb">int</span> <span class="p">{</span>
  <span class="nb">int</span> <span class="n">n</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;enter a number: &#39;</span><span class="p">);</span>
  <span class="n">println</span><span class="p">();</span>
  <span class="k">print</span><span class="p">(</span><span class="s1">&#39;fact(&#39;</span><span class="p">);</span>
  <span class="k">print</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="k">print</span><span class="p">(</span><span class="s1">&#39;) = &#39;</span><span class="p">);</span>
  <span class="k">print</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">));</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>

<h2 id="pruebas">Pruebas<a class="headerlink" href="#pruebas" title="Permanent link">&para;</a></h2>
<p>Para probar lo que genera su implementación pueden utilizar lo siguiente:</p>
<div class="codehilite"><pre><span></span>sudo ./gradlew build <span class="c1"># para compilar su laboratorio</span>
sudo ./gradlew clean assemble <span class="c1"># no deberia necesitarlo, pero si hay algun problema que no se quita</span>
./compile &lt;archivo.vp&gt;  <span class="c1"># compilar usando su laboratorio</span>
./vipercl &lt;archivo.vp&gt;  <span class="c1"># usar el compilador de prueba</span>
</pre></div>

<p>En la carpeta <strong>examples/</strong> hay un par de ejemplos.</p>
<h2 id="autograder">Autograder<a class="headerlink" href="#autograder" title="Permanent link">&para;</a></h2>
<p>Para probar su implementación pueden utilizar este comando:</p>
<div class="codehilite"><pre><span></span>./check
</pre></div>

<p>Si todo está bien, tendrían que obtener la siguiente salida:</p>
<div class="codehilite"><pre><span></span>          Autograder


+4.55      <span class="o">(</span>while2<span class="o">)</span>       
+4.55        <span class="o">(</span>leq<span class="o">)</span>        
+4.55        <span class="o">(</span>lt<span class="o">)</span>         
+4.55        <span class="o">(</span>eq<span class="o">)</span>         
+4.55       <span class="o">(</span>call<span class="o">)</span>        
+4.55       <span class="o">(</span>arith<span class="o">)</span>       
+4.55       <span class="o">(</span>fibo<span class="o">)</span>        
+4.55   <span class="o">(</span>declaration2<span class="o">)</span>    
+4.55     <span class="o">(</span>factorial<span class="o">)</span>     
+4.55   <span class="o">(</span>declaration3<span class="o">)</span>    
+4.55        <span class="o">(</span>if2<span class="o">)</span>        
+4.55        <span class="o">(</span>not<span class="o">)</span>        
+4.55      <span class="o">(</span>assign2<span class="o">)</span>      
+4.55     <span class="o">(</span>constants<span class="o">)</span>     
+4.55      <span class="o">(</span><span class="k">return</span><span class="o">)</span>       
+4.55        <span class="o">(</span>lt2<span class="o">)</span>        
+4.55       <span class="o">(</span><span class="k">while</span><span class="o">)</span>       
+4.55        <span class="o">(</span>if1<span class="o">)</span>        
+4.55    <span class="o">(</span>declaration<span class="o">)</span>    
+4.55      <span class="o">(</span>assign<span class="o">)</span>       
+4.55       <span class="o">(</span>leq2<span class="o">)</span>        
+4.55       <span class="o">(</span>not2<span class="o">)</span>        


<span class="o">=</span>&gt; You got a score of <span class="m">100</span> out of <span class="m">100</span>.
</pre></div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../lab-9-codegen/" title="Lab 9 (CodeGen I)" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Lab 9 (CodeGen I)
              </span>
            </div>
          </a>
        
        
          <a href="../lab-11-optimizaciones/" title="Lab 11 (Optimizaciones)" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                Lab 11 (Optimizaciones)
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            CC-4
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/CC-4" class="md-footer-social__link fa fa-github"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.b41f3d20.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../../assets/javascripts/lunr/lunr.es.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script>
      
        <script src="../../js/latex.js"></script>
      
        <script src="../../js/python.js"></script>
      
    
    
      
    
  </body>
</html>
